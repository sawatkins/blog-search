{% extends "base.html" %}

{% block title %}Blog Search{% endblock %}

{% block content %}
    <form id="search-form" class="w-full" action="/search" method="get">
        <div class="relative flex justify-center w-full max-w-md mx-auto">
            <input type="text" name="q" id="search-input"
                class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-gray-400 focus:outline-none focus:ring-0 text-base"
                autocomplete="off" autocapitalize="off"
                autocorrect="off" placeholder="Enter your search query..." autofocus value="{{ query or '' }}">
            <button type="submit" id="search-button"
                class="absolute right-0 top-0 bottom-0 bg-[#52718f] hover:bg-[#405c78] rounded-r-md w-10 flex items-center justify-center transition-colors cursor-pointer">
                <img src="/static/img/arrow-sm-right.svg" alt="Search" class="w-4 h-4 brightness-0 invert">
            </button>
        </div>
    </form>

    <div id="home-content" class="w-full mt-8">
        <br>
        <h3 class="font-medium text-lg">About</h3>
        <p class="mb-1">Blog search is a search engine focused on indexing personal blog content in English.</p>
        <p class="mb-1">It's a personal project of mine. It currently indexes <strong class="font-mono">{{ posts_size or '_' }}</strong> blog posts.</p>
        <br>
        <details class="mb-2">
            <summary class="cursor-pointer font-mono text-[#52718f]">More Information</summary>
            <ul class="mt-2 list-disc pl-5">
                <li>This project is still in development. <i>Everything will be greatly expanded and improved soon.</i> <a href="https://github.com/sawatkins/blog-search" class="text-blue-600 hover:underline">GitHub.</a></li>
                <li>Queries work best with correctly spelled general keywords.</li>
                <li>It currently uses PostgreSQL's full text search for indexing and ranking.</li>
                <li>It is hosted on a single-node Kubernetes cluster with k3s.</li>
                <li>The current list of blogs to index is compiled from <a href="https://github.com/outcoldman/hackernews-personal-blogs" target="_blank" class="text-blue-600 hover:underline">this list of HN blogs</a> and from <a href="https://ooh.directory/blogs/technology/" target="_blank" class="text-blue-600 hover:underline">ooh's tech directory</a>.</li>
            </ul>
        </details>

        <details class="mb-2">
            <summary class="cursor-pointer font-mono text-[#52718f]">Feedback</summary>
            <p class="mt-2">Please provide your feedback on <a href="https://tally.so/r/mBe7We" target="_blank" class="text-blue-600 hover:underline">this form</a>.</p>
        </details>

        <details class="mb-2">
            <summary class="cursor-pointer font-mono text-[#52718f]">API</summary>
            <p class="mt-2">Search result endpoint:</p>
            <pre class="bg-gray-100 p-2 rounded my-2 font-mono"><code>GET /api/search?q={query}</code></pre>
            <p>Returns: JSON object with an array of search results, or an empty array if no results are found.</p>
            <pre class="bg-gray-100 p-2 rounded my-2 font-mono"><code>{
  "results": [
    {
      "url": "https://example.com/blog-post",
      "title": "Example Blog Post",
      "date": "2023-04-15",
      "snippet": "Post content snippet..."
    },
    // More results...
  ]
}</code></pre>

            <p>Example Usage:</p>
            <pre class="bg-gray-100 p-2 rounded my-2 font-mono"><code style="white-space: pre-wrap;"># Python
r = requests.get("https://blogsearch.io/api/search", params={"q": "your search query"})
results = r.json()["results"]</code></pre>
        </details>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById('search-form').addEventListener('submit', function (event) {
            var query = document.getElementById('search-input').value.trim();
            if (query === '') {
                event.preventDefault();
                document.getElementById('search-input').focus();
                console.log('Empty search prevented');
            }
        });
    </script>
{% endblock %}